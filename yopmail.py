########################################################
# THIS SCRIPT DOESN'T WORK ANYMORE /!\
# YOPMAIL BLOCKED ALL ATTACHMENT  /!\
#   .---.   .--.   .--.
#  /  _.-' |  00| |  00|
#  \FUK'-. |mal_| |ware| Yopmail.com
#   '---'  '^^^^' '^^^^'
# README:
# Catch all attachment in malware mailbox
# Better to run once a day (cron.daily) to avoid captcha
# @tfairane - https://github.com/tfairane
########################################################
import requests
from bs4 import BeautifulSoup
from subprocess import call
import re
import datetime

r = requests.get("http://malware.yopmail.com")
soup = BeautifulSoup(r.text, 'html.parser')
yp = soup.input["value"]
r = requests.get("http://www.yopmail.com/style/2.6/webmail.js")
yj = re.search("yj=([\w]+)&", r.text).group(1)
r = requests.get("http://malware.yopmail.com/en/inbox.php?login=malware&p=1&d=&ctrl=&scrl=&spam=true&yf=003&yp=%s&yj=%s&v=2.6&r_c=&id=" % (yp, yj))
soup = BeautifulSoup(r.text, 'html.parser')
for a in soup.find_all("a", {"class": "lm" } ):
    r = requests.get("http://malware.yopmail.com/%s"%a["href"])
    soup = BeautifulSoup(r.text, 'html.parser')
    for a in soup.find_all("a", {"class": "mgif pj"}):
        href = a["href"]
        text = a.text.replace("/","\\")
        d = str(datetime.date.today().year)+"-"+str(datetime.date.today().month)+"-"+str(datetime.date.today().day)
        call(["mkdir", d])
        call(["wget", "http://malware.yopmail.com/"+href, "-b", "-q", "-O", d+"/"+text, "--referer", "http://malware.yopmail.com"])
